<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0ea5e9" />
  <title>USEN Auto-Open PWA</title>
  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="icon" href="./icons/icon-192.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <style>
    :root { color-scheme: light dark; }
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans JP", "Apple Color Emoji", "Segoe UI Emoji"; 
           margin: 0; min-height: 100dvh; display: grid; place-items: center; background: #0ea5e920; }
    .card { width: min(720px, 92vw); background: #fff; color: #111; border-radius: 16px; padding: 20px; box-shadow: 0 6px 24px rgba(0,0,0,.08); }
    @media (prefers-color-scheme: dark) { .card { background: #111; color: #eee; } }
    h1 { margin: 0 0 12px; font-size: 1.4rem; }
    p { margin: .5rem 0; line-height: 1.6; }
    .row { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
    .btn { appearance: none; border: 0; padding: 10px 16px; border-radius: 12px; font-weight: 600; cursor: pointer; background: #0ea5e9; color: #fff; }
    .btn:disabled { opacity: .6; cursor: not-allowed; }
    .switch { display: inline-flex; align-items: center; gap: 8px; cursor: pointer; user-select: none; }
    .hint { font-size: .9rem; opacity: .8; }
    .pill { display:inline-block; padding: 2px 8px; border-radius: 999px; background:#0ea5e933; color:#0369a1; font-size:.75rem; font-weight:700; }
    code { background: #00000010; padding: 2px 6px; border-radius: 6px; }
    .footer { margin-top: 10px; font-size: .85rem; opacity: .8; }
  </style>
</head>
<body>
  <main class="card">
    <h1>USENページ 自動遷移PWA</h1>
    <p class="hint">
      目的URL：<code id="targetUrlText"></code>
    </p>

    <div class="row" style="margin:12px 0 8px;">
      <label class="switch">
        <input id="autoToggle" type="checkbox" />
        <span>自動遷移を有効にする（ONで起動時に自動で開く）</span>
      </label>
      <span id="statePill" class="pill">OFF</span>
    </div>

    <div class="row" style="margin:8px 0 16px;">
      <button id="openBtn" class="btn">今すぐ開く</button>
      <button id="cancelBtn" class="btn" style="background:#64748b; display:none;">自動遷移を中止</button>
    </div>

    <p class="hint" id="info"></p>

    <div class="footer">
      <div>インストール（PWA）：ブラウザのメニューから「アプリをインストール」「ホーム画面に追加」などを選択。</div>
    </div>
  </main>

  <script src="./app.js"></script>
  <script>
    // サービスワーカー登録
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("./service-worker.js").catch(console.error);
      });
    }
  </script>
</body>
</html>
